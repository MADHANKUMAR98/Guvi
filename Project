-- Retrieve User Details
SELECT U.User_Id, U.User_Name, U.Address_Id, A.House_Number, A.Street_Name, A.Area_Name, A.City_Name, A.State_Name, A.Pin_Code, U.Phone_Number, U.Meter_Id, U.Email_Address, U.Account_Created_Timestamp
FROM EBS_User_Table U
JOIN EBS_Address_Table A ON U.Address_Id = A.Address_Id
WHERE U.User_Id = 'user01';

-- List All Users
SELECT U.User_Id, U.User_Name, A.House_Number, A.Street_Name, A.Area_Name, A.City_Name, A.State_Name, A.Pin_Code, U.Phone_Number, U.Meter_Id, U.Email_Address, U.Account_Created_Timestamp
FROM EBS_User_Table U
JOIN EBS_Address_Table A ON U.Address_Id = A.Address_Id;

-- View Pending Bills for a User
SELECT B.Bill_Id, B.Amount, U.Month, U.Usage_Reading
FROM EBS_Billing_Table B
JOIN EBS_Usage_Table U ON B.Usage_Id = U.Usage_Id
WHERE U.User_Id = 'user01' AND B.Bill_Id NOT IN (SELECT Bill_Id FROM EBS_Payment_Table);

-- Generate Bill for a User
INSERT INTO EBS_Billing_Table (Bill_Id, Usage_Id, Amount)
SELECT 'bill03', Usage_Id, Usage_Reading * 0.25
FROM EBS_Usage_Table
WHERE User_Id = 'user01' AND Usage_Id = 'usage03'; -- Adjust Usage_Id as necessary

-- Make a Payment
INSERT INTO EBS_Payment_Table (Payment_Id, Bill_Id, Payment_Method_Id, Payment_Made_At)
VALUES ('pay03', 'bill03', 1, CURRENT_TIMESTAMP); -- Ensure Bill_Id exists

-- View Payment History
SELECT P.Payment_Id, P.Bill_Id, PM.Payment_Method_Description, P.Payment_Made_At
FROM EBS_Payment_Table P
JOIN EBS_Payment_Method_Table PM ON P.Payment_Method_Id = PM.Payment_Method_Id
WHERE P.Bill_Id IN (SELECT Bill_Id FROM EBS_Billing_Table WHERE User_Id = 'user01');

-- Add a New Customer
INSERT INTO EBS_User_Table (User_Id, User_Name, Address_Id, Phone_Number, Meter_Id, Email_Address)
VALUES ('user02', 'Jane Smith', 'addr02', '9123456789', 102, 'jane@example.com');

-- Update User Information
UPDATE EBS_User_Table
SET User_Name = 'John Smith', Phone_Number = '9112233445'
WHERE User_Id = 'user01';

-- Delete a User
DELETE FROM EBS_User_Table WHERE User_Id = 'user02';

-- View All Meters
SELECT M.Meter_Id, M.Meter_Number, MS.Meter_Status_Description
FROM EBS_Meter_Table M
JOIN EBS_Meter_Status_Table MS ON M.Meter_Status_Id = MS.Meter_Status_Id;

-- View All Usage Records
SELECT U.User_Id, U.User_Name, U.Phone_Number, U.Email_Address, US.Usage_Id, US.Month, US.Usage_Reading, A.Admin_Id, A.Admin_Name
FROM EBS_Usage_Table US
JOIN EBS_User_Table U ON US.User_Id = U.User_Id
JOIN EBS_Admin_Table A ON US.Admin_Id = A.Admin_Id;
