package pojo;

import java.util.HashMap;
import java.util.Map;

public class Customer {
    private String id;
    private String name;
    private String address;
    private String meterNumber;
    private String password;
    private Map<String, Double> usage;
    private Map<String, Double> bills;
    private Map<String, Double> paymentHistory;

    public Customer(String id, String name, String address, String meterNumber, String password) {
        this.id = id;
        this.name = name;
        this.address = address;
        this.meterNumber = meterNumber;
        this.password = password;
        this.usage = new HashMap<>();
        this.bills = new HashMap<>();
        this.paymentHistory = new HashMap<>();
    }

    // Getters and Setters

    public void addUsage(String month, double usageInkwh) {
        this.usage.put(month, usageInkwh);
    }

    public double generateBill(String month) {
        double usageInkwh = this.usage.getOrDefault(month, 0.0);
        if (usageInkwh > 0 && !this.bills.containsKey(month)) {
            double billAmount = usageInkwh * 6; // Assume Rs 6 per kWh
            this.bills.put(month, billAmount);
            return billAmount;
        }
        return 0.0;
    }

    public void makePayment(String month, double payment) {
        this.paymentHistory.put(month, payment);
        this.bills.remove(month);
    }

    public Map<String, Double> getPaymentHistory() {
        return this.paymentHistory;
    }

    public Map<String, Double> getBills() {
        return this.bills;
    }

    // Additional methods as needed
}

private void viewPaymentHistory() {
    Customer customer = customerService.fetchCustomer(loggedInCustomerId);
    if (customer != null) {
        System.out.println("Payment History:");
        Map<String, Double> payments = customer.getPaymentHistory();
        payments.forEach((month, amount) -> {
            System.out.println("Month: " + month + ", Amount: Rs " + amount);
        });
    } else {
        System.out.println("Customer not found.");
    }
}

private void makePayment() {
    System.out.print("Enter month (e.g., July 2024): ");
    String month = scanner.nextLine();
    System.out.print("Enter payment amount: ");
    double payment = scanner.nextDouble();

    Customer customer = customerService.fetchCustomer(loggedInCustomerId);
    if (customer != null) {
        double amountDue = customer.getBills().getOrDefault(month, 0.0);
        if (payment >= amountDue) {
            customer.makePayment(month, payment);
            customerService.updateCustomer(customer);
            System.out.println("Payment successful.");
        } else {
            System.out.println("Insufficient payment. Please pay the full amount.");
        }
    } else {
        System.out.println("Customer not found.");
    }
}
